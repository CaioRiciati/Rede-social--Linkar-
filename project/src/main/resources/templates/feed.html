<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="pt-br">
<head>
    <meta charset="UTF-8">
    <title>Linkar</title>

   <link rel="stylesheet" href="/css/home.css">
   <style>

   /* ===========================================
      BASE GERAL
      =========================================== */
   body {
       font-family: Arial, sans-serif;
       background-color: #1d1f23;
       background-image: radial-gradient(circle at center, #3c3f46 0%, #1d1424 100%);
       margin: 0;
       padding: 0;
       min-height: 100vh;
       color: white;
       display: flex;
       flex-direction: column;
   }

   /* HEADER ‚Äî MANTIDO DO JEITO QUE VOC√ä PEDIU */
   header {
       background-color: #0b8457;
       color: white;
       padding: 15px;
       display: flex;
       justify-content: space-between;
       align-items: center;
   }

   /* ===========================================
      FEED + ABAS
      =========================================== */
   .feed-container {
       width: 700px;
       margin: 25px auto;
       color: white;
   }

   /* Cont√™iner das abas */
   .tabs {
       display: flex;
       gap: 10px;
       background-color: rgba(73, 73, 73, 0.35);
       border-radius: 12px;
       padding: 8px;
       margin-top: 20px;
       backdrop-filter: blur(6px);
   }

   /* Aba individual */
   .tab {
       padding: 10px 25px;
       border-radius: 8px;
       background-color: #2c2f36;
       cursor: pointer;
       text-decoration: none;
       color: white;
       font-weight: 600;
       transition: background 0.25s, transform 0.2s;
   }

   .tab:hover {
       background-color: #3b3e46;
       transform: translateY(-2px);
   }

   .tab.active {
       background-color: #0b8457;
       box-shadow: 0 0 10px rgba(0, 200, 130, 0.45);
   }

   /* ===========================================
      POST (CARD)
      =========================================== */
   .post {
       background-color: #2b2f36;
       padding: 20px;
       border-radius: 14px;
       margin-bottom: 25px;
       border: 1px solid rgba(255,255,255,0.05);
       box-shadow: 0 0 12px rgba(0,0,0,0.4);
       transition: transform .2s, box-shadow .2s;
   }

   .post:hover {
       transform: translateY(-3px);
       box-shadow: 0 0 25px rgba(0,0,0,0.5);
   }

   .post-header {
       display: flex;
       justify-content: space-between;
       align-items: center;
   }

   .post-header h3 {
       margin: 0;
       color: #00e89d;
   }

   .post p {
       line-height: 1.4;
       margin-top: 10px;
   }

   /* Imagem do post */
   .post img {
       max-width: 100%;
       border-radius: 10px;
       margin-top: 12px;
       border: 1px solid #444;
   }

   /* ===========================================
      FILE INPUT ESTILIZADO
      =========================================== */
   .postar input[type="file"] {
       display: none;
   }

   .file-label {
       display: inline-block;
       background: #1f2227;
       border: 1px solid #3a3d45;
       color: #cfcfcf;
       padding: 10px 16px;
       border-radius: 10px;
       cursor: pointer;
       transition: 0.25s ease;
       font-weight: 600;
       margin-top: 10px;
   }

   .file-label:hover {
       background: #292c33;
       border-color: #4b4e56;
       transform: translateY(-2px);
   }

   .file-name {
       margin-top: 8px;
       font-size: 0.9em;
       color: #9e9e9e;
   }

   /* ===========================================
      SELECT ESTILIZADO
      =========================================== */
   .postar select {
       margin-top: 10px;
       padding: 12px;
       background: #1f2227;
       color: white;
       border: 1px solid #3a3d45;
       border-radius: 12px;
       font-size: 0.95em;
       width: 100%;
       cursor: pointer;
       appearance: none;
       transition: border 0.25s ease, box-shadow 0.25s ease;
       background-image: url("data:image/svg+xml;utf8,<svg fill='white' height='18' viewBox='0 0 24 24' width='18' xmlns='http://www.w3.org/2000/svg'><path d='M7 10l5 5 5-5z'/></svg>");
       background-repeat: no-repeat;
       background-position: right 14px center;
   }

   .postar select:focus {
       border-color: #0b8457;
       box-shadow: 0 0 10px rgba(11, 132, 87, 0.4);
   }

   /* ===========================================
      COMENT√ÅRIOS
      =========================================== */

   .comentarios {
       background: #24262c;
       padding: 12px;
       border-radius: 12px;
       margin-top: 12px;
       border: 1px solid rgba(255,255,255,0.08);
   }

   .comentario {
       background: #34373d;
       padding: 10px;
       border-radius: 8px;
       margin-top: 8px;
   }

   .comentario strong {
       color: #00e89d;
   }

   .comentarios input[type="text"] {
       width: 85%;
       padding: 8px;
       background: #1e2024;
       border: 1px solid #3a3d45;
       border-radius: 8px;
       color: white;
   }

   /* ===========================================
      CARD DE PUBLICA√á√ÉO
      =========================================== */
   .postar {
       background: #2b2f36;
       border-radius: 14px;
       padding: 25px;
       width: 680px;
       margin: 120px auto 25px auto;
       box-shadow: 0 0 18px rgba(0, 0, 0, 0.35);
       border: 1px solid rgba(255,255,255,0.05);
   }

   .Escreva {
       width: 100%;
       background: #1f2227;
       color: white;
       border: 1px solid #3a3d45;
       border-radius: 10px;
       padding: 12px;
       font-size: 1em;
       resize: none;
   }

   .preview {
       margin-top: 12px;
       background: #1f2227;
       border: 1px solid #3a3d45;
       border-radius: 10px;
       padding: 10px;
       max-height: 250px;
       overflow-y: auto;
   }

   .preview-image-style {
       max-width: 100%;
       max-height: 220px;
       border-radius: 8px;
   }

   .Publicar {
       display: block;
       margin-left: auto;
       margin-top: 18px;
       background: linear-gradient(135deg, #0b8457, #0d9c67);
       border: none;
       border-radius: 10px;
       padding: 10px 22px;
       color: white;
       font-size: 1.05em;
       font-weight: bold;
       cursor: pointer;
   }

   </style>

</head>

<body>

	<!-- TOPO -->
	<!-- TOPO -->
		  <header class="topo">
		    <div class="logo">
		      <div class="icone-logo"> <img th:src="@{/images/logo.png}" class="icone-logo2" alt="√çcone Feed"></div>
		      <span>Linkar</span>
		    </div>

		<nav class="navegacao">

		    <a th:href="@{/feed}" class="nav-item ativo">

		      <img th:src="@{/images/casa.png}" class="icone-agenda" alt="√çcone Feed">
		      <span>Feed</span>
		    </a>
		    <a th:href="@{/agenda}" class="nav-item">
		      <img th:src="@{/images/agenda.png}" class="icone-feed" alt="√çcone Agenda">
		      <span>Agenda</span>
		    </a>
		</nav>


		    <div class="icones-topo">
		    <button id="btn-busca" class="btn-icone"> 

		        <img th:src="@{/images/lupa.png}" alt="√çcone busca"> 
		    </button>
		    <button id="btn-sino" class="btn-icone"> 
		        <img th:src="@{/images/sino.png}" alt="√çcone sino"> 
		    </button>
		    <button id="btn-perfil" class="btn-icone"> 
		        <img th:src="@{/images/user_icon.png}" alt="√çcone perfil"> 
		    </button>
		  </div>
		  </header>





		  <form class="postar" th:action="@{/salvar-post}" method="post" enctype="multipart/form-data">
		      <label>Conte√∫do:</label>
		      <textarea class="Escreva" name="conteudo" rows="4" placeholder="Oque ira postar hoje?"></textarea>

			  <label>Foto:</label>
			  <label for="foto" class="file-label">üìÅ Escolher imagem</label>
			  <input type="file" id="foto" name="foto" accept="image/*" onchange="previewImage(event)">
			  <span id="fileName" class="file-name"></span>

		      
		      <label>Visibilidade:</label>
		      <select name="categoria">
		          <option value="TODOS">Todos</option>
		          <option value="ALUNO">Alunos</option>
		          <option value="PROFESSOR">Professores</option>
		          <option value="DIRECAO">Gest√£o</option>
		      </select>
		      <div class="preview" id="preview"></div>

		      <button class="Publicar" type="submit">Publicar</button>
		  </form>

		  <script>
		      function previewImage(event) {
		          const preview = document.getElementById('preview');
		          preview.innerHTML = '';
		          const file = event.target.files[0];
		          if (file) {
		              const img = document.createElement('img');
		              img.src = URL.createObjectURL(file);
		              // Adicione uma classe CSS √† imagem para que possamos estiliz√°-la
		              img.classList.add('preview-image-style'); 
		              preview.appendChild(img);
		          }
		      }
		  </script>

<div class="feed-container">




    <!-- ABAS -->
    <div class="tabs">
        <a class="tab"
           th:classappend="${categoriaAtual == 'TODOS'} ? ' active'"
           href="/feed?categoria=TODOS">Todos</a>

        <a class="tab"
           th:if="${usuario != null and (usuario.tipo == 'ALUNO' or usuario.tipo == 'PROFESSOR' or usuario.tipo == 'DIRECAO')}"
           th:classappend="${categoriaAtual == 'ALUNOS'} ? ' active'"
           href="/feed?categoria=ALUNOS">Alunos</a>

        <a class="tab"
           th:if="${usuario != null and (usuario.tipo == 'PROFESSOR' or usuario.tipo == 'DIRECAO')}"
           th:classappend="${categoriaAtual == 'PROFESSORES'} ? ' active'"
           href="/feed?categoria=PROFESSORES">Professores</a>

        <a class="tab"
           th:if="${usuario != null and usuario.tipo == 'DIRECAO'}"
           th:classappend="${categoriaAtual == 'DIRECAO'} ? ' active'"
           href="/feed?categoria=DIRECAO">Dire√ß√£o</a>
    </div>

    <!-- SEM POSTS -->
    <div th:if="${#lists.isEmpty(posts)}" style="text-align:center; margin-top:20px;">
        Nenhum post encontrado nessa categoria.
    </div>

    <!-- LISTA DE POSTS -->
    <div th:each="post : ${posts}" class="post">

        <div class="post-header">
            <h3 th:text="${post.usuario.nome}"></h3>
            <span th:text="${#temporals.format(post.criadoEm, 'dd/MM HH:mm')}"></span>
        </div>

        <p th:text="${post.conteudo}"></p>

		<img th:if="${post.fotoUrl != null}"
		     th:src="@{'/imagens/' + ${post.fotoUrl}}"
		     style="max-width:100%; border-radius:8px; margin-top:10px;">

        <p style="font-size:12px; color:gray;">
            Categoria: <b th:text="${post.categoria}"></b>
        </p>

        <!-- CURTIDAS -->
        <button class="btn"
                th:attr="data-id=${post.id}"
                onclick="curtirPost(this)">
            ‚ù§Ô∏è Curtir (<span th:attr="id='qtd-curtidas-' + ${post.id}"
                             th:text="${post.qtdCurtidas}"></span>)
        </button>

        <!-- BOT√ÉO VER COMENT√ÅRIOS -->
        <button class="btn"
                th:attr="id='toggle-'+${post.id}"
                onclick="toggleComentarios([[${post.id}]])">
            üí¨ Coment√°rios
        </button>

        <!-- LISTA DE COMENT√ÅRIOS -->
        <div class="comentarios"
             th:attr="id='comentarios-'+${post.id}"
             style="display:none; margin-top:10px;">

            <div th:each="comentario : ${post.comentarios}" class="comentario">
                <strong th:text="${comentario.usuario.nome}"></strong>:
                <span th:text="${comentario.conteudo}"></span>
            </div>

            <!-- NOVO COMENT√ÅRIO -->
            <form th:if="${usuario != null}"
                  th:action="@{/posts/comentar}" method="post" style="margin-top:10px;">
                <input type="hidden" name="postId" th:value="${post.id}">
                <input type="text" name="texto" placeholder="Escreva um coment√°rio...">
                <button class="btn" type="submit">Enviar</button>
            </form>

        </div>

    </div> <!-- fim each -->

</div>

<!-- SCRIPTS -->
<script>
    function toggleComentarios(id) {
        let box = document.getElementById("comentarios-" + id);
        box.style.display = box.style.display === "none" ? "block" : "none";
    }

    function curtirPost(btn) {
        let id = btn.getAttribute("data-id");

        fetch("/posts/" + id + "/curtir", { method: "POST" })
            .then(r => r.json())
            .then(data => {
                document.getElementById("qtd-curtidas-" + id).innerText = data.qtd;0
            });
    }
</script>

</body>
</html>

